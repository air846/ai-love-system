# 用户中心功能测试指南

## 功能概述

本次开发完成了完整的用户中心模块，包括：

1. **个人资料管理** - 用户可以编辑个人信息、上传头像
2. **账户设置** - 密码修改、邮箱验证、登录历史查看
3. **偏好设置** - 主题、通知、AI角色偏好、隐私设置
4. **文件上传** - 头像上传功能，支持图片压缩和尺寸调整

## 测试步骤

### 1. 启动应用

#### 后端启动
```bash
cd backend
mvn spring-boot:run -Dspring-boot.run.profiles=dev
```

#### 前端启动
```bash
cd frontend
npm install
npm run dev
```

### 2. 访问用户中心

1. 打开浏览器访问 `http://localhost:5173`
2. 登录系统（如果没有账户，先注册）
3. 在左侧导航栏点击"个人中心"或在右上角用户头像下拉菜单中选择"个人信息"

### 3. 功能测试清单

#### 3.1 个人资料编辑
- [ ] 修改昵称
- [ ] 修改邮箱地址
- [ ] 修改手机号
- [ ] 选择性别
- [ ] 设置生日
- [ ] 编辑个人简介
- [ ] 上传头像（测试图片格式：jpg, png, gif）
- [ ] 验证表单验证规则（邮箱格式、手机号格式等）

#### 3.2 账户设置
- [ ] 修改密码（测试原密码验证）
- [ ] 查看登录历史信息
- [ ] 查看账户状态
- [ ] 邮箱验证状态显示

#### 3.3 偏好设置
- [ ] 主题设置（浅色/深色/跟随系统）
- [ ] 字体大小调整
- [ ] 主色调选择
- [ ] 语言设置
- [ ] 通知开关设置
- [ ] 免打扰时间设置
- [ ] AI角色偏好设置
- [ ] 对话风格选择
- [ ] 响应速度调整
- [ ] 隐私设置开关
- [ ] 数据保留期限设置

#### 3.4 文件上传
- [ ] 头像上传（支持格式：jpg, jpeg, png, gif, webp）
- [ ] 文件大小限制测试（最大5MB）
- [ ] 图片自动压缩和尺寸调整
- [ ] 上传后头像实时更新

### 4. API测试

可以使用Swagger UI进行API测试：
访问 `http://localhost:8080/api/swagger-ui.html`

#### 主要API端点：
- `GET /auth/profile` - 获取用户信息
- `PUT /auth/profile` - 更新用户信息
- `GET /auth/preferences` - 获取用户偏好设置
- `PUT /auth/preferences` - 更新用户偏好设置
- `POST /auth/preferences/reset` - 重置偏好设置
- `POST /upload/avatar` - 上传头像
- `DELETE /upload/file` - 删除文件

### 5. 数据库验证

检查数据库中的数据是否正确保存：

```sql
-- 查看用户表结构和数据
SELECT * FROM users;

-- 查看用户偏好设置（JSON格式）
SELECT id, username, preferences FROM users WHERE preferences IS NOT NULL;
```

### 6. 已知问题和待完善功能

1. **邮箱验证功能** - 目前只是UI展示，实际发送验证邮件功能待实现
2. **账户注销功能** - 目前只是UI展示，实际注销逻辑待实现
3. **文件清理** - 需要定期清理未使用的上传文件
4. **头像缓存** - 可以考虑添加CDN或缓存机制

### 7. 性能优化建议

1. **图片优化** - 已实现自动压缩，可考虑添加WebP格式支持
2. **懒加载** - 用户中心页面可以考虑懒加载优化
3. **缓存策略** - 用户偏好设置可以添加本地缓存
4. **响应式设计** - 移动端适配可以进一步优化

### 8. 安全考虑

1. **文件上传安全** - 已限制文件类型和大小
2. **路径遍历防护** - 文件存储路径已做安全处理
3. **权限控制** - 所有用户中心功能都需要登录认证
4. **数据验证** - 前后端都有完整的数据验证

## 总结

用户中心模块已基本完成，提供了完整的个人信息管理功能。用户可以：
- 管理个人资料和头像
- 修改账户设置和密码
- 自定义使用偏好
- 查看账户状态和登录历史

所有功能都经过了基本的安全性和可用性考虑，为后续功能扩展提供了良好的基础。
